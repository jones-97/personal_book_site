<!DOCTYPE html>
<html lang="en">


<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Books</title>
    <link rel="stylesheet" href="books.css" />
</head>
<body>
    <div class="header">BOOKS </div>
	 <div class="login"> 
     
     <button onclick="manage()">Manage</button>
     </div>
    <div class="content" id="books-container">
   
   <!-- Books are loaded here by Javascript -->
   
 
    </div>
    <div class="footer"> About: <span>c 2025</span></div>
    
     <script>
        async function fetchBooks() {
            try {
                const response = await fetch("/api/books"); // Fetch books from backend
                const books = await response.json();
                const container = document.getElementById("books-container");

                // Clear existing content
                container.innerHTML = "";

                for (const book of books) {
					
                   const bookCard = document.createElement("div");
                   bookCard.classList.add("book-card");
					
				   const recentChapter = await fetchRecentChapter(book._id);

                   bookCard.innerHTML = `
                        <div class="book-image">
                            <img src="${book.coverImage || 'https://via.placeholder.com/100x150'}" alt="${book.title} Cover">
                        </div>
                        <div class="book-details">
							<a href="view_book.html?bookId=${book._id}" style="color: #FF4081; font-size: 1.2rem; text-decoration: none;">${book.title}
							</a>
							</div>		
							
							
                            <div class="recent-chapter">Recent Chapter: <span class="recent-chapter-title">${recentChapter || 'No chapters yet'}</span>
                        </div>
                    `;
                    container.appendChild(bookCard);
					
                }
            } catch (error) {
                console.error("Error fetching books:", error);
            }
        }

async function fetchRecentChapter(bookId) {
	try {
		const response = await fetch(`/api/chapters/book/${bookId}/latest`);
		 if (!response.ok) throw new Error('Failed to fetch latest chapter for books in books.html');
	    const latestChapter = await response.json();
	   console.log("Latest chapter for : " + bookId + " is: " + latestChapter);
	   return latestChapter;
	   
		
	} catch (error) {
		
		console.error("Problem getting recent chapter: ", error);
		return null;
	}
	
	
}

function manage() {
	window.location.href='/admin';
	}
        // Load books when the page loads
        window.onload = fetchBooks();
		
    </script>
</body>
</html>
