<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reset Password</title>
    <link rel="stylesheet" href="admin.css" />
</head>
<body>
    <div class="header">RESET PASSWORD
    <button onclick="backHome()">Return</button></div>
    <div class="content">
        <p class="message">A reset link has been sent to your email(s) containing the reset code.</p>
        <div class="form-container">
            <form id="reset-form">
                <label for="reset-code">Reset Code:</label>
                <input type="text" id="reset-code" name="reset-code">

                <label for="new-password">New Password:</label>
                <input type="password" id="new-password" name="new-password">

                <label for="confirm-password">Confirm New Password:</label>
                <input type="password" id="confirm-password" name="confirm-password">

                <button type="submit" class="reset-btn">Submit</button>
            </form>
        </div>
    </div>
    
    <script> 
	
	function validateForm(resetCode, newPassword, confirmPassword) {
    if (!resetCode || resetCode.trim() === "") {
        alert("Verification code needed");
        return false;
    }

    if (!newPassword || newPassword.trim() === "" || !confirmPassword || confirmPassword.trim() === "") {
        alert("Please fill in all password fields.");
        return false;
    }

    if (newPassword !== confirmPassword) {
        alert("Passwords do not match.");
        return false;
    }

    return true;
}
		
	document.getElementById('reset-form').addEventListener('submit', async (e) => {
    e.preventDefault();

    // Get values inside the event listener
    const resetCode = document.getElementById('reset-code').value;
    const newPassword = document.getElementById('new-password').value;
    const confirmPassword = document.getElementById('confirm-password').value;

    // Validate the form
    if (!validateForm(resetCode, newPassword, confirmPassword)) {
        return; // Stop if validation fails
    }

    try {
        const response = await fetch('/api/admin/reset-password', {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ code: resetCode, newPassword }) // Use `code` as the key
        });

        const data = await response.json();
        alert(data.message);

        if (response.ok) {
            window.location.href = "access_page.html"; // Redirect on success
        }
    } catch (error) {
        console.error('Error resetting password:', error);
        alert('Failed to reset password. Please try again.');
    }
});
  
  
    function backHome() {
		window.location.href="/admin";
	}
    
    </script>
</body>
</html>
